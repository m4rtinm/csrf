<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SecureBank ‚Äì Simulador CSRF</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    body{background:linear-gradient(135deg,#0a0a0a 0%,#1a1a1a 50%,#2a2a2a 100%);min-height:100vh;color:#ffffff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;margin:0;padding:0;}
    
    /* Barra superior √∫nica */
    .main-header{
      background:#1f1f1f;
      box-shadow:0 4px 20px rgba(0,0,0,.5);
      padding:1.5rem 0;
      margin-bottom:1.5rem;
      border-bottom:1px solid #404040;
      width:100%;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .main-header .container-fluid {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .main-header h1 {
      font-size: 2.2rem;
      margin-bottom: 0.5rem;
    }
    
    .main-header p {
      font-size: 1.1rem;
      margin-bottom: 1rem;
    }
    
    /* Botones de navegaci√≥n */
    .nav-button {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #ffffff;
      padding: 0.6rem 1.2rem;
      border-radius: 0.5rem;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      margin: 0 0.5rem;
      font-size: 0.95rem;
    }
    
    .nav-button:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }
    
    .nav-button.active {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      border-color: #2563eb;
    }
    
    /* Estilo espec√≠fico para el modo desaf√≠o activo */
    .nav-button.challenge-active {
      background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
      border-color: #f59e0b;
      color: white;
    }
    
    .nav-button.challenge-active:hover {
      background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      transform: translateY(-2px);
    }
    
    /* P√°ginas */
    .page {
      display: none;
    }
    
    .page.active {
      display: block;
    }
    
    /* Estilos del centro de aprendizaje */
    .learning-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .learning-header {
      text-align: center;
      margin-bottom: 3rem;
    }
    
    .learning-header h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .learning-nav {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    
    .learning-nav-button {
      background: #2a2a2a;
      border: 1px solid #404040;
      color: #ffffff;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .learning-nav-button:hover {
      background: #404040;
      transform: translateY(-2px);
    }
    
    .learning-nav-button.active {
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      border-color: #dc2626;
    }
    
    .learning-content {
      background: #1f1f1f;
      border: 1px solid #404040;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    
    .theory-section {
      display: none;
    }
    
    .theory-section.active {
      display: block;
    }
    
    .theory-section h3 {
      color: #60a5fa;
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
    }
    
    .theory-section h4 {
      color: #ffffff;
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }
    
    .vulnerability-card, .tool-card, .mitigation-card {
      background: #2a2a2a;
      border: 1px solid #404040;
      border-left: 4px solid #dc2626;
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      transition: all 0.3s ease;
    }
    
    .vulnerability-card:hover, .tool-card:hover, .mitigation-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(220,38,38,0.2);
    }
    
    .tool-card {
      border-left-color: #2563eb;
    }
    
    .tool-card:hover {
      box-shadow: 0 4px 20px rgba(37,99,235,0.2);
    }
    
    .mitigation-card {
      border-left-color: #22c55e;
    }
    
    .mitigation-card:hover {
      box-shadow: 0 4px 20px rgba(34,197,94,0.2);
    }
    
    .code-example {
      background: #0a0a0a;
      color: #00ff88;
      font-family: 'Fira Code', Monaco, Consolas, monospace;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #404040;
      margin: 1rem 0;
      overflow-x: auto;
    }
    
    .csrf-flow {
      background: #1a1a1a;
      border: 1px solid #404040;
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin: 1rem 0;
    }
    
    .csrf-flow h5 {
      color: #ff6b6b;
      margin-bottom: 1rem;
    }
    
    .flow-step {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: #2a2a2a;
      border-radius: 0.5rem;
      border-left: 3px solid #dc2626;
    }
    
    .flow-step-number {
      background: #dc2626;
      color: white;
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-weight: bold;
    }
    
    .headers-example {
      background: #1a1a1a;
      border: 1px solid #22c55e;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
    }
    
    .headers-example h5 {
      color: #22c55e;
      margin-bottom: 0.5rem;
    }
    
    .headers-example code {
      background: #0a0a0a;
      color: #00ff88;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
    }
    
    /* Estilos para el diagrama */
    .diagram-container {
      background: #1a1a1a;
      border: 1px solid #404040;
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin: 1.5rem 0;
      text-align: center;
    }
    
    .diagram-container img {
      max-width: 100%;
      height: auto;
      border-radius: 0.5rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    
    .diagram-container h5 {
      color: #60a5fa;
      margin-bottom: 1rem;
    }
    
    .diagram-container p {
      color: #a9b1d6;
      font-size: 0.9rem;
      margin-top: 1rem;
    }
    
    @media (max-width: 768px) {
      .navbar-content {
        flex-direction: column;
        gap: 1rem;
      }
      
      .nav-button {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
        margin: 0 0.25rem;
      }
      
      .learning-container {
        padding: 1rem;
      }
      
      .learning-header h1 {
        font-size: 2rem;
      }
      
      .learning-nav {
        flex-direction: column;
        align-items: center;
      }
      
      .learning-nav-button {
        width: 100%;
        text-align: center;
      }
    }
    .card{background:#1f1f1f;box-shadow:0 8px 32px rgba(0,0,0,.6);border:1px solid #404040;border-radius:.75rem;overflow:hidden;width:100%;min-height:450px;}
    .card-header{font-weight:600;padding:1rem 1.5rem;border-bottom:1px solid #404040;color:#ffffff;}
    .user-card .card-header{background:#2563eb;color:white;}
    .attacker-card .card-header{background:#dc2626;color:white;}
    .chat-card .card-header{background:#128c7e;color:white;}
    
    /* Mejorar el dise√±o de las columnas */
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    @media (min-width: 1600px) {
      .main-container {
        max-width: 1200px;
      }
    }
    
    @media (min-width: 992px) {
      .row {
        display: flex;
        flex-wrap: wrap;
        align-items: stretch;
      }
      .col-12.col-lg-4 {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
      }
      .card {
        height: 100%;
        min-height: 500px;
      }
    }
    
    @media (min-width: 1200px) {
      .card {
        min-height: 600px;
      }
    }
    
    @media (max-width: 991px) {
      .col-12 {
        margin-bottom: 1rem;
      }
      .card {
        min-height: auto;
      }
    }
    .balance-box{background:linear-gradient(135deg,#2563eb 0%,#1d4ed8 100%);border-radius:.75rem;padding:1.25rem;color:white;text-align:center;margin-bottom:1.25rem;box-shadow:0 4px 20px rgba(37,99,235,.4);width:100%;}
    .balance-amount{font-size:2.2rem;font-weight:800;margin:.5rem 0;text-shadow:0 2px 4px rgba(0,0,0,.4);}
    @media (max-width: 768px) {
      .balance-amount{font-size:2.5rem;}
      .balance-box{padding:1.5rem;}
      .form-section{padding:1rem;}
      .card-header{padding:0.75rem 1rem;}
      .info-box{padding:1rem;margin-bottom:1rem;}
      .codebox{padding:1rem;font-size:0.9rem;}
    }
    @media (max-width: 576px) {
      .balance-amount{font-size:2rem;}
      .balance-box{padding:1rem;}
      .container-custom{padding:0 0.5rem;}
      .form-section{padding:0.75rem;}
      .card-body{padding:1rem;}
      .btn{font-size:0.9rem;padding:0.75rem 1rem;}
      .bubble{font-size:0.9rem;padding:0.75rem 1rem;}
      .chat-container{padding:1rem;flex:1;}
      .chat-card{display:flex;flex-direction:column;}
      .chat-card .card-body{flex:1;display:flex;flex-direction:column;}
    }
    @media (max-width: 480px) {
      .balance-amount{font-size:1.75rem;}
      .balance-box{padding:0.75rem;}
      .form-section{padding:0.5rem;}
      .card-header{padding:0.5rem 0.75rem;font-size:0.9rem;}
      .btn{font-size:0.85rem;padding:0.6rem 0.8rem;}
      .bubble{font-size:0.85rem;padding:0.6rem 0.8rem;}
      .chat-container{flex:1;}
      .chat-card{display:flex;flex-direction:column;}
      .chat-card .card-body{flex:1;display:flex;flex-direction:column;}
      .main-header{padding:1rem 0;}
      .main-header h1{font-size:1.75rem;}
      .main-header p{font-size:1rem;}
    }
    
    /* Ajustes espec√≠ficos para el layout de 3 columnas */
    @media (min-width: 1400px) {
      .container-custom{max-width:1400px;}
      .chat-container{flex:1;}
      .chat-card{display:flex;flex-direction:column;}
      .chat-card .card-body{flex:1;display:flex;flex-direction:column;}
    }
    @media (min-width: 1200px) {
      .container-custom{max-width:1200px;}
      .chat-container{flex:1;}
      .chat-card{display:flex;flex-direction:column;}
      .chat-card .card-body{flex:1;display:flex;flex-direction:column;}
    }
    @media (min-width: 992px) and (max-width: 1199px) {
      .chat-container{flex:1;}
      .chat-card{display:flex;flex-direction:column;}
      .chat-card .card-body{flex:1;display:flex;flex-direction:column;}
    }
    .account-info{opacity:.95;font-size:.95rem;margin-top:.5rem;}
    .form-section{background:#2a2a2a;padding:1rem;border-radius:.75rem;margin-bottom:1rem;border:1px solid #404040;}
    .form-section h6{color:#ffffff;margin-bottom:1rem;font-weight:600;font-size:1rem;}
    .form-label{font-weight:500;color:#e5e5e5;margin-bottom:.4rem;font-size:.95rem;}
    .form-control{background:#1a1a1a;border:1px solid #555555;border-radius:.5rem;padding:.65rem .9rem;font-size:.9rem;transition:all .2s;color:#ffffff;}
    .form-control:focus{background:#1a1a1a;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.3);color:#ffffff;}
    .form-control::placeholder{color:#999999;}
    .btn-transfer{background:linear-gradient(135deg,#2563eb 0%,#1d4ed8 100%);border:none;padding:.75rem 1.25rem;font-weight:600;border-radius:.5rem;font-size:.95rem;transition:all .2s;color:white;}
    .btn-transfer:hover{background:linear-gradient(135deg,#1d4ed8 0%,#2563eb 100%);transform:translateY(-1px);box-shadow:0 4px 20px rgba(37,99,235,.5);color:white;}
    .btn-attack{background:linear-gradient(135deg,#dc2626 0%,#ef4444 100%);border:none;padding:.75rem 1.25rem;font-weight:600;border-radius:.5rem;font-size:.95rem;transition:all .2s;color:white;}
    .btn-attack:hover{background:linear-gradient(135deg,#ef4444 0%,#f87171 100%);transform:translateY(-1px);box-shadow:0 4px 20px rgba(220,38,38,.5);color:white;}
    .btn-secondary{background:linear-gradient(135deg,#6b7280 0%,#9ca3af 100%);border:none;padding:.75rem 1.25rem;font-weight:600;border-radius:.5rem;font-size:.95rem;transition:all .2s;color:white;}
    .btn-secondary:hover{background:linear-gradient(135deg,#9ca3af 0%,#d1d5db 100%);transform:translateY(-1px);color:#1f1f1f;}
    .btn-warning{background:linear-gradient(135deg,#f59e0b 0%,#f97316 100%);border:none;padding:.75rem 1.25rem;font-weight:600;border-radius:.5rem;font-size:.95rem;transition:all .2s;color:white;}
    .btn-warning:hover{background:linear-gradient(135deg,#f97316 0%,#fb923c 100%);transform:translateY(-1px);box-shadow:0 4px 20px rgba(245,158,11,.5);color:white;}
    .btn-success{background:linear-gradient(135deg,#22c55e 0%,#16a34a 100%);border:none;padding:.75rem 1.25rem;font-weight:600;border-radius:.5rem;font-size:.95rem;transition:all .2s;color:white;}
    .btn-success:hover{background:linear-gradient(135deg,#16a34a 0%,#15803d 100%);transform:translateY(-1px);box-shadow:0 4px 20px rgba(34,197,94,.5);color:white;}
    
    /* Estilos para el modo desaf√≠o */
    .challenge-mode {
      border: 2px solid #f59e0b;
      animation: challengeGlow 2s ease-in-out infinite alternate;
      position: relative;
      overflow: visible;
    }
    
    .challenge-mode::before {
      content: "üéØ MODO DESAF√çO";
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      z-index: 500;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      box-shadow: 0 2px 8px rgba(245,158,11,0.4);
      white-space: nowrap;
    }
    
    @keyframes challengeGlow {
      from {
        box-shadow: 0 0 20px rgba(245,158,11,0.3);
      }
      to {
        box-shadow: 0 0 30px rgba(245,158,11,0.6);
      }
    }
    
    .challenge-header {
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      color: white;
      padding: 1rem;
      margin: -1rem -1rem 1rem -1rem;
      border-radius: 0.5rem 0.5rem 0 0;
      font-weight: 600;
      text-align: center;
      animation: challengePulse 3s ease-in-out infinite;
    }
    
    @keyframes challengePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    .challenge-target {
      background: rgba(245,158,11,0.1);
      border: 1px solid rgba(245,158,11,0.3);
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    
    .challenge-payload {
      min-height: 150px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      background: #1f2937;
      color: #10b981;
      border: 1px solid #374151;
      border-radius: 0.5rem;
      padding: 1rem;
      resize: vertical;
    }
    
    .challenge-payload::placeholder {
      color: #6b7280;
    }
    
    .challenge-result {
      padding: 1rem;
      border-radius: 0.5rem;
      margin-top: 1rem;
      font-weight: 600;
      text-align: center;
      animation: resultSlide 0.5s ease-out;
    }
    
    .challenge-result.success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: 2px solid #10b981;
    }
    
    .challenge-result.error {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: 2px solid #ef4444;
    }
    
    @keyframes resultSlide {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .challenge-header {
      background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
      color: white;
      padding: 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      text-align: center;
      font-weight: 600;
    }
    
    .challenge-target {
      background: #1a1a1a;
      border: 1px solid #f59e0b;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
    }
    
    .challenge-target h6 {
      color: #f59e0b;
      margin-bottom: 0.5rem;
    }
    
    .challenge-payload {
      background: #0a0a0a;
      color: #ffffff;
      font-family: 'Fira Code', Monaco, Consolas, monospace;
      font-size: 0.85rem;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #f59e0b;
      min-height: 120px;
      resize: vertical;
    }
    
    .challenge-payload:focus {
      outline: none;
      border-color: #f97316;
      box-shadow: 0 0 0 3px rgba(245,158,11,0.3);
    }
    
    .challenge-result {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 0.5rem;
      font-weight: 500;
      text-align: center;
      display: none;
    }
    
    .challenge-result.success {
      background: #22c55e;
      color: white;
    }
    
    .challenge-result.error {
      background: #ef4444;
      color: white;
    }
    .codebox{background:#0a0a0a;color:#00ff88;font-family:'Fira Code',Monaco,Consolas,monospace;font-size:.85rem;padding:1rem;border-radius:.5rem;white-space:pre-wrap;min-height:80px;border:1px solid #404040;box-shadow:inset 0 2px 4px rgba(0,0,0,.4);overflow-x:auto;word-break:break-all;}
    .codebox-green{color:#00ff88;}
    .info-box{background:#1a1a1a;border:1px solid #2563eb;border-left:4px solid #3b82f6;padding:1rem;margin-bottom:1rem;border-radius:.5rem;font-size:.9rem;}
    .info-box strong{color:#60a5fa;}
    .info-box{color:#e5e5e5;}
    .bubble{max-width:80%;padding:1rem 1.25rem;border-radius:18px;margin-bottom:.75rem;font-size:.95rem;word-wrap:break-word;line-height:1.4;position:relative;}
    .bubble strong, .bubble b {
      font-weight: 700 !important;
      color: inherit;
    }
    .bubble b{font-weight:700;color:inherit;}
    .left-bub{background:#ffffff;border:none;box-shadow:0 2px 8px rgba(0,0,0,.15);color:#1f1f1f;margin-right:auto;}
    .right-bub{background:#dcf8c6;margin-left:auto;border:none;box-shadow:0 2px 8px rgba(0,0,0,.15);color:#1f1f1f;}
    .system-bub{background:#e3f2fd;border:1px solid #2196f3;color:#0d47a1;margin:0 auto;max-width:95%;font-size:.9rem;border-radius:12px;text-align:center;}
    .app-bub{background:#f3e5f5;border:1px solid #9c27b0;color:#4a148c;margin:0 auto;max-width:95%;font-size:.9rem;border-radius:12px;text-align:center;font-style:italic;}
    .left-bub::before{content:'';position:absolute;top:0;left:-8px;width:0;height:0;border-top:8px solid transparent;border-right:8px solid #ffffff;border-bottom:8px solid transparent;}
    .right-bub::before{content:'';position:absolute;top:0;right:-8px;width:0;height:0;border-top:8px solid transparent;border-left:8px solid #dcf8c6;border-bottom:8px solid transparent;}
    .chat-container{background:#e5ddd5;border-radius:.75rem;padding:1rem;overflow-y:auto;border:1px solid #404040;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="chat-pattern" patternUnits="userSpaceOnUse" width="50" height="50"><circle cx="25" cy="25" r="1" fill="%23ffffff" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23chat-pattern)"/></svg>');flex:1;max-height:calc(100vh - 200px);}
    .chat-card{overflow:hidden;display:flex;flex-direction:column;}
    .chat-card .card-body{flex:1;display:flex;flex-direction:column;}
    
    /* Asegurar que todas las tarjetas tengan la misma altura din√°micamente */
    .main-container .row {
      display: flex;
      align-items: stretch;
    }
    
    .main-container .col-12 {
      display: flex;
    }
    
    .main-container .card {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .main-container .card-body {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    /* El chat se adapta din√°micamente a la altura de las otras columnas */
    .chat-card .card-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    
    .chat-container {
      flex: 1;
      min-height: 0;
    }
    
    /* Ajustar solo los tama√±os m√≠nimos seg√∫n el tama√±o de pantalla */
    @media (min-width: 1200px) {
      .card{min-height:550px;}
      .chat-container{max-height:calc(100vh - 180px);}
      .balance-amount{font-size:2.4rem;}
      .info-box{font-size:.95rem;}
      .codebox{font-size:.9rem;}
    }
    @media (min-width: 992px) and (max-width: 1199px) {
      .card{min-height:500px;}
      .chat-container{max-height:calc(100vh - 200px);}
    }
    @media (max-width: 991px) {
      .card{min-height:450px;}
      .chat-container{max-height:calc(100vh - 220px);}
    }
    .history-table{font-size:.8rem;margin-bottom:0;color:#ffffff;}
    .history-table th{background:#0f172a;border-bottom:2px solid #475569;font-weight:600;color:#f1f5f9;padding:.75rem .5rem;font-size:.75rem;}
    .history-table td{padding:.65rem .5rem;border-bottom:1px solid #475569;color:#f1f5f9;background:#1e293b;font-size:.75rem;}
    .history-table tbody tr:hover{background:#334155;}
    .status-badge{font-size:.8rem;padding:.35rem .75rem;border-radius:.375rem;font-weight:500;}
    .transfer-msg{background:#1a1a1a;border:1px solid #22c55e;color:#22c55e;padding:1rem;border-radius:.5rem;text-align:center;margin:1rem 0;font-weight:500;}
    .session-badge{background:#22c55e;color:white;font-size:.8rem;padding:.4rem .8rem;border-radius:.375rem;font-weight:500;}
    .modal-content{background:#1f1f1f;border:1px solid #404040;color:#ffffff;}
    .modal-header{background:#1a1a1a;border-bottom:1px solid #404040;padding:1.5rem;color:#ffffff;}
    .modal-body{line-height:1.6;padding:1.5rem;color:#e5e5e5;}
    .modal-body pre{background:#0a0a0a;color:#00ff88;padding:1.25rem;border-radius:.5rem;font-size:.9rem;border:1px solid #404040;}
    .modal-body code{background:#1a1a1a;color:#ff6b6b;padding:.25rem .5rem;border-radius:.25rem;font-size:.9rem;font-weight:500;border:1px solid #404040;}
    .modal-body ol{padding-left:1.5rem;}
    .modal-body li{margin-bottom:.5rem;}
    footer{font-size:.85rem;color:#cccccc;text-align:center;margin-top:3rem;opacity:.8;}
    .table-responsive{border-radius:.5rem;overflow:hidden;}
    .alert-info{background:#1a1a1a;border:1px solid #2563eb;color:#60a5fa;border-radius:.5rem;}
    .container-custom{max-width:100%;margin:0 auto;padding:0 1rem;width:100%;}
    @media (min-width: 1400px) {
      .container-custom{max-width:1400px;padding:0 2rem;}
    }
    @media (min-width: 1200px) {
      .container-custom{max-width:1200px;padding:0 1.5rem;}
    }
    @media (min-width: 992px) {
      .container-custom{max-width:100%;padding:0 1rem;}
    }
    @media (min-width: 768px) {
      .container-custom{max-width:100%;padding:0 1rem;}
    }
    @media (min-width: 576px) {
      .container-custom{max-width:100%;padding:0 1rem;}
    }
    @media (max-width: 575px) {
      .container-custom{padding:0 0.5rem;}
    }
    .text-primary{color:#60a5fa!important;}
    .text-muted{color:#cccccc!important;}
    .btn-close{filter:invert(1) brightness(2);}
    .btn-primary{background:#2563eb;border-color:#2563eb;color:white;}
    .btn-primary:hover{background:#1d4ed8;border-color:#1d4ed8;color:white;}
    .text-danger{color:#ff6b6b!important;}
    .card-body{color:#e5e5e5;padding:1rem;}
    h1, h2, h3, h4, h5, h6{color:#ffffff;}
    .left-bub::after{content:'';position:absolute;bottom:3px;left:-8px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid #ffffff;border-top:8px solid #ffffff;border-bottom:8px solid transparent;}
    .right-bub::after{content:'';position:absolute;bottom:3px;right:-8px;width:0;height:0;border-left:8px solid #dcf8c6;border-right:8px solid transparent;border-top:8px solid #dcf8c6;border-bottom:8px solid transparent;}
    .chat-time{font-size:.75rem;color:#666666;margin-top:.25rem;text-align:right;}
    .amount-input{background:#1a1a1a;border:1px solid #dc2626;border-radius:.5rem;padding:.5rem .75rem;color:#ffffff;margin:.5rem 0;width:150px;}
    .amount-input:focus{border-color:#ef4444;outline:none;box-shadow:0 0 0 2px rgba(239,68,68,.2);}
  </style>
</head>
<body>
<div class="main-header">
  <div class="container-fluid">
    <div class="text-center">
      <h1 class="mb-2 fw-bold text-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-shield-lock me-2" viewBox="0 0 16 16">
          <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
          <path d="M9.5 6.5a1.5 1.5 0 0 1-1 1.415l.385 1.99a.5.5 0 0 1-.491.595h-.788a.5.5 0 0 1-.49-.595L7.5 7.915A1.5 1.5 0 1 1 9.5 6.5z"/>
        </svg>
        SecureBank - Simulador CSRF
      </h1>
      <p class="text-muted mb-0 fs-5">Laboratorio interactivo para entender y prevenir ataques Cross-Site Request Forgery (CSRF)</p>
      
      <!-- Navegaci√≥n integrada -->
      <div class="mt-3">
        <button class="nav-button active" data-page="simulator">
          üß™ Simulador
        </button>
        <button class="nav-button" data-page="learning">
          üìö Centro de Aprendizaje
        </button>
        <button class="nav-button" id="challengeNavBtn">
          üéØ Modo Desaf√≠o
        </button>
      </div>
    </div>
  </div>
</div>

<!-- P√°gina del Simulador -->
<div class="page active" id="simulator-page">

<div class="container-fluid px-3">
  <div class="main-container">
    <div class="row g-3 justify-content-center">
      <!-- Usuario -->
      <div class="col-12 col-lg-4 col-xl-4 mb-3">
        <div class="card h-100 user-card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span><i class="bi bi-person-fill me-2"></i>Vista del Usuario</span>
          <span class="session-badge">Sesi√≥n activa</span>
        </div>
        <div class="card-body">
          <!-- Contenido normal del usuario -->
          <div id="userNormalContent">
            <div class="balance-box">
              <div class="small mb-2">Saldo Disponible</div>
              <div id="balanceText" class="balance-amount">$5,000.00</div>
              <div class="account-info">Cuenta: **** **** **** 4321</div>
            </div>

            <div class="form-section">
              <h6><i class="bi bi-arrow-right-circle me-2"></i>Realizar transferencia</h6>
              <div class="mb-3">
                <label class="form-label">Cuenta destino</label>
                <input id="to" class="form-control" placeholder="4000-1234-5678-9999" value="4000-1234-5678-9999"/>
              </div>
              <div class="mb-3">
                <label class="form-label">Cantidad ($)</label>
                <input id="amount" type="number" min="1" class="form-control" value="100"/>
              </div>
              <button id="transferBtn" class="btn btn-transfer w-100">
                <i class="bi bi-send me-2"></i>Transferir
              </button>
            </div>

            <div id="transferMsg" class="transfer-msg" style="display:none;"></div>
          </div>
          
          <!-- Contenido del modo desaf√≠o -->
          <div id="userChallengeContent" style="display:none;">
            <div class="balance-box" style="background:linear-gradient(135deg,#f59e0b 0%,#f97316 100%);">
              <div class="small mb-2">Perfil de Usuario</div>
              <div class="balance-amount" style="font-size:1.8rem;">üë§ JohnDoe</div>
              <div class="account-info">Usuario: john.doe@securebank.com</div>
            </div>

            <div class="form-section">
              <h6><i class="bi bi-shield-lock me-2"></i>Configuraci√≥n de Seguridad</h6>
              <div class="mb-3">
                <label class="form-label">Contrase√±a actual</label>
                <input id="currentPassword" class="form-control" type="password" placeholder="Ingresa tu contrase√±a actual"/>
              </div>
              <div class="mb-3">
                <label class="form-label">Nueva contrase√±a</label>
                <input id="newPassword" class="form-control" type="password" placeholder="Ingresa nueva contrase√±a"/>
              </div>
              <div class="mb-3">
                <label class="form-label">Confirmar contrase√±a</label>
                <input id="confirmPassword" class="form-control" type="password" placeholder="Confirma tu nueva contrase√±a"/>
              </div>
              <button id="changePasswordBtn" class="btn btn-warning w-100">
                <i class="bi bi-lock me-2"></i>Cambiar Contrase√±a
              </button>
            </div>

            <div class="info-box">
              <strong>Estado del usuario:</strong><br/>
              El usuario est√° navegando por su perfil de seguridad. Es vulnerable a ataques CSRF si visita una p√°gina maliciosa mientras est√° autenticado.
            </div>
          </div>

          <!-- Historial solo visible en modo normal -->
          <div id="historialSection" class="form-section">
            <h6><i class="bi bi-clock-history me-2"></i>Historial de transferencias</h6>
            <div class="table-responsive">
              <table class="table table-sm history-table" id="history">
                <thead><tr><th>Fecha</th><th>Destinatario</th><th>Monto</th><th>Estado</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Atacante -->
    <div class="col-12 col-lg-4 col-xl-4 mb-3">
      <div class="card h-100 attacker-card">
        <div class="card-header">
          <i class="bi bi-bug-fill me-2"></i>Vista del Atacante
        </div>
        <div class="card-body">
          <div class="info-box">
            <strong>¬øQu√© es CSRF?</strong><br/>
            CSRF (Cross-Site Request Forgery) es un ataque que enga√±a al navegador de un usuario para que ejecute acciones no deseadas en una aplicaci√≥n donde est√° autenticado.
          </div>

          <h6><i class="bi bi-crosshair me-2"></i>Solicitud capturada</h6>
          <div id="captureBox" class="codebox mb-3">Esperando transferencia del usuario‚Ä¶</div>
          
          <div class="mb-3">
            <label class="form-label">Cantidad ($)</label>
            <input id="stealAmount" type="number" min="1" class="form-control amount-input" value="1500" placeholder="Ingresa la cantidad"/>
          </div>
          
          <button id="sendAttack" class="btn btn-attack w-100 mb-3">
            <i class="bi bi-exclamation-triangle me-2"></i>Generar payload malicioso
          </button>

          <div class="info-box">
            <strong>¬øC√≥mo funciona el exploit?</strong><br/>
            El atacante crea una p√°gina HTML maliciosa que contiene un formulario oculto que replica la solicitud de transferencia. Cuando la v√≠ctima visita esa p√°gina, el navegador env√≠a la solicitud autom√°ticamente.
          </div>

          <h6><i class="bi bi-code-slash me-2"></i>PoC generada</h6>
          <div id="pocBox" class="codebox codebox-green mb-3">// El exploit se generar√° aqu√≠ despu√©s de capturar una solicitud</div>

          <button id="sendPhishing" class="btn btn-attack w-100 mb-3" style="display:none;">
            <i class="bi bi-send me-2"></i>Enviar mensaje a la v√≠ctima
          </button>
          <button id="explainBtn" class="btn btn-secondary w-100 mb-3" style="display:none;">
            <i class="bi bi-question-circle me-2"></i>¬øC√≥mo funciona el exploit?
          </button>
          <button id="challengeBtn" class="btn btn-warning w-100 mb-3" style="display:none;">
            <i class="bi bi-trophy me-2"></i>¬°Ahora te toca a ti!
          </button>
          
          <!-- Contenido del desaf√≠o -->
          <div id="challengeContent" style="display:none;">
            <div class="challenge-header">
              <i class="bi bi-target me-2"></i>DESAF√çO: Crea tu propio ataque CSRF
            </div>
            
            <div class="challenge-target">
              <h6><i class="bi bi-bullseye me-2"></i>Objetivo Capturado</h6>
              <div id="challengeTargetBox" class="codebox mb-3">
                <!-- Aqu√≠ aparecer√° la nueva solicitud objetivo -->
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label"><i class="bi bi-code-slash me-2"></i>Crea tu payload CSRF:</label>
              <textarea id="challengePayload" class="challenge-payload w-100" placeholder="Escribe tu formulario HTML malicioso aqu√≠..."></textarea>
            </div>
            
            <button id="submitChallenge" class="btn btn-success w-100 mb-3">
              <i class="bi bi-send me-2"></i>Lanzar Ataque
            </button>
            
            <div id="challengeResult" class="challenge-result"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat -->
    <div class="col-12 col-lg-4 col-xl-4 mb-3">
      <div class="card h-100 chat-card">
        <div class="card-header">
          <i class="bi bi-chat-dots-fill me-2"></i>Chat SecuroBank
        </div>
        <div class="card-body">
          <div class="chat-container" id="msgs"></div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <footer>
    Simulador Educativo de CSRF ‚Äî SecureBank ¬© 2025 | Este sitio es una simulaci√≥n para fines educativos
  </footer>
</div>
</div>

<!-- P√°gina del Centro de Aprendizaje -->
<div class="page" id="learning-page">
  <div class="learning-container">
    <div class="learning-header">
      <h1>Centro de Aprendizaje CSRF</h1>
      <p class="text-muted">Aprende todo sobre Cross-Site Request Forgery y c√≥mo protegerte</p>
    </div>
    
    <div class="learning-nav">
      <button class="learning-nav-button active" data-section="introduction">
        üéØ Introducci√≥n
      </button>
      <button class="learning-nav-button" data-section="how-it-works">
        ‚öôÔ∏è C√≥mo Funciona
      </button>
      <button class="learning-nav-button" data-section="vulnerabilities">
        ‚ö†Ô∏è Vulnerabilidades
      </button>
      <button class="learning-nav-button" data-section="mitigations">
        üõ°Ô∏è Mitigaciones
      </button>
      <button class="learning-nav-button" data-section="tools">
        üõ†Ô∏è Herramientas
      </button>
      <button class="learning-nav-button" data-section="examples">
        üìù Ejemplos
      </button>
    </div>
    
    <div class="learning-content">
      <!-- Introducci√≥n -->
      <div class="theory-section active" id="introduction">
        <h3>üéØ ¬øQu√© es CSRF?</h3>
        
        <p><strong>CSRF (Cross-Site Request Forgery)</strong> es un ataque que enga√±a al navegador de un usuario para que ejecute acciones no deseadas en una aplicaci√≥n web donde el usuario est√° autenticado.</p>
        
        <div class="vulnerability-card">
          <h4>üîç Definici√≥n T√©cnica</h4>
          <p>CSRF es una vulnerabilidad que permite a un atacante inducir a los usuarios a realizar acciones que no tienen la intenci√≥n de realizar. En un ataque CSRF exitoso, el atacante hace que la v√≠ctima ejecute una acci√≥n no deseada en una aplicaci√≥n web en la que la v√≠ctima est√° autenticada.</p>
        </div>
        
        <div class="vulnerability-card">
          <h4>üéØ Objetivo del Ataque</h4>
          <p>El objetivo principal es aprovecharse de la confianza que una aplicaci√≥n web tiene en el navegador del usuario. Si un usuario est√° autenticado en un sitio web, el navegador enviar√° autom√°ticamente las cookies de sesi√≥n con cada solicitud a ese dominio.</p>
        </div>
        
        <div class="vulnerability-card">
          <h4>üí∞ Impacto Potencial</h4>
          <ul>
            <li>Transferencias bancarias no autorizadas</li>
            <li>Cambios de configuraci√≥n de cuenta</li>
            <li>Compras fraudulentas</li>
            <li>Modificaci√≥n o eliminaci√≥n de datos</li>
            <li>Cambios de contrase√±a</li>
            <li>Acciones administrativas no autorizadas</li>
          </ul>
        </div>
        
        <div class="csrf-flow">
          <h5>üìä Estad√≠sticas CSRF</h5>
          <p><strong>OWASP Top 10 2021:</strong> A01:2021 - Broken Access Control (incluye CSRF)</p>
          <p><strong>Prevalencia:</strong> Aproximadamente 94% de aplicaciones tienen alguna forma de control de acceso roto</p>
          <p><strong>Impacto:</strong> Promedio de 5.4 Common Weakness Enumerations (CWEs) por aplicaci√≥n</p>
        </div>
      </div>
      
      <!-- C√≥mo Funciona -->
      <div class="theory-section" id="how-it-works">
        <h3>‚öôÔ∏è C√≥mo Funciona un Ataque CSRF</h3>
        
        <div class="csrf-flow">
          <h5>üîÑ Flujo del Ataque CSRF</h5>
          
          <div class="flow-step">
            <div class="flow-step-number">1</div>
            <div>
              <strong>Autenticaci√≥n Leg√≠tima</strong><br>
              El usuario se autentica en el sitio web objetivo (ej: banco online) y recibe cookies de sesi√≥n
            </div>
          </div>
          
          <div class="flow-step">
            <div class="flow-step-number">2</div>
            <div>
              <strong>Captura de Solicitud</strong><br>
              El atacante observa o captura una solicitud HTTP leg√≠tima del usuario (ej: transferencia bancaria)
            </div>
          </div>
          
          <div class="flow-step">
            <div class="flow-step-number">3</div>
            <div>
              <strong>Creaci√≥n del Payload</strong><br>
              El atacante crea una p√°gina web maliciosa que replica la solicitud capturada
            </div>
          </div>
          
          <div class="flow-step">
            <div class="flow-step-number">4</div>
            <div>
              <strong>Enga√±o Social</strong><br>
              El atacante enga√±a al usuario para que visite la p√°gina maliciosa (email, link, etc.)
            </div>
          </div>
          
          <div class="flow-step">
            <div class="flow-step-number">5</div>
            <div>
              <strong>Ejecuci√≥n Autom√°tica</strong><br>
              El navegador env√≠a autom√°ticamente la solicitud forjada con las cookies de sesi√≥n
            </div>
          </div>
          
          <div class="flow-step">
            <div class="flow-step-number">6</div>
            <div>
              <strong>Procesamiento del Servidor</strong><br>
              El servidor procesa la solicitud como si fuera leg√≠tima, ejecutando la acci√≥n no deseada
            </div>
          </div>
        </div>
        
        <div class="diagram-container">
          <h5>üìä Diagrama Visual del Ataque CSRF</h5>
          <img src="csrf.png" alt="Diagrama del Ataque CSRF" class="img-fluid"/>
          <p>
            <em>Representaci√≥n visual del flujo completo de un ataque CSRF desde la perspectiva del atacante y la v√≠ctima</em>
          </p>
        </div>
        
        <div class="code-example">
          <h5>üìù Ejemplo de Payload CSRF</h5>
          <pre><code>&lt;!-- Formulario oculto que se env√≠a autom√°ticamente --&gt;
&lt;form action="https://banco.com/transfer" method="POST" style="display:none;"&gt;
  &lt;input name="to" value="cuenta-atacante"&gt;
  &lt;input name="amount" value="1000"&gt;
  &lt;input name="currency" value="EUR"&gt;
&lt;/form&gt;

&lt;script&gt;
  // Env√≠o autom√°tico al cargar la p√°gina
  document.forms[0].submit();
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      <!-- Vulnerabilidades -->
      <div class="theory-section" id="vulnerabilities">
        <h3>‚ö†Ô∏è Condiciones para un Ataque CSRF Exitoso</h3>
        
        <div class="vulnerability-card">
          <h4>üç™ Dependencia de Cookies</h4>
          <p>La aplicaci√≥n debe usar cookies para autenticaci√≥n. El navegador las enviar√° autom√°ticamente con cada solicitud al dominio, incluso si la solicitud se origina desde otro sitio.</p>
        </div>
        
        <div class="vulnerability-card">
          <h4>üîì Falta de Verificaci√≥n de Origen</h4>
          <p>La aplicaci√≥n no verifica que la solicitud provenga del sitio leg√≠timo. No valida headers como <code>Origin</code> o <code>Referer</code>.</p>
        </div>
        
        <div class="vulnerability-card">
          <h4>üé´ Ausencia de Tokens Anti-CSRF</h4>
          <p>No hay tokens √∫nicos que vinculen la solicitud con la sesi√≥n del usuario. Cada formulario deber√≠a incluir un token secreto impredecible.</p>
        </div>
        
        <div class="vulnerability-card">
          <h4>üîÑ Acciones Predecibles</h4>
          <p>Las acciones sensibles tienen par√°metros predecibles que un atacante puede replicar f√°cilmente (nombres de campo, formatos, etc.).</p>
        </div>
        
        <div class="vulnerability-card">
          <h4>üåê Configuraci√≥n Insegura de SameSite</h4>
          <p>Las cookies no tienen el atributo <code>SameSite</code> configurado o est√°n configuradas como <code>None</code>, permitiendo solicitudes cross-site.</p>
        </div>
        
        <div class="vulnerability-card">
          <h4>üìã M√©todos HTTP Inseguros</h4>
          <p>La aplicaci√≥n permite cambios de estado usando m√©todos GET, o acepta tanto GET como POST para acciones sensibles.</p>
        </div>
      </div>
      
      <!-- Mitigaciones -->
      <div class="theory-section" id="mitigations">
        <h3>üõ°Ô∏è Mitigaciones y Defensas</h3>
        
        <div class="mitigation-card">
          <h4>üé´ Tokens Anti-CSRF</h4>
          <p>Implementar tokens √∫nicos, impredecibles y vinculados a la sesi√≥n del usuario.</p>
          
          <div class="headers-example">
            <h5>Implementaci√≥n en HTML</h5>
            <code>&lt;input type="hidden" name="csrf_token" value="abc123xyz789"&gt;</code>
          </div>
          
          <div class="headers-example">
            <h5>Validaci√≥n en el servidor</h5>
            <code>
              if ($_POST['csrf_token'] !== $_SESSION['csrf_token']) {<br>
              &nbsp;&nbsp;die('CSRF token inv√°lido');<br>
              }
            </code>
          </div>
        </div>
        
        <div class="mitigation-card">
          <h4>üç™ Configuraci√≥n Segura de Cookies</h4>
          <p>Usar el atributo <code>SameSite</code> para prevenir el env√≠o de cookies en solicitudes cross-site.</p>
          
          <div class="headers-example">
            <h5>Configuraci√≥n recomendada</h5>
            <code>Set-Cookie: sessionid=abc123; SameSite=Strict; Secure; HttpOnly</code>
          </div>
          
          <div class="headers-example">
            <h5>Opciones SameSite</h5>
            <ul>
              <li><code>Strict</code>: Nunca env√≠a cookies cross-site</li>
              <li><code>Lax</code>: Solo en navegaci√≥n top-level</li>
              <li><code>None</code>: Permite cross-site (requiere Secure)</li>
            </ul>
          </div>
        </div>
        
        <div class="mitigation-card">
          <h4>üîç Verificaci√≥n de Origen</h4>
          <p>Validar las cabeceras <code>Origin</code> y <code>Referer</code> para asegurar que las solicitudes provienen del dominio correcto.</p>
          
          <div class="headers-example">
            <h5>Validaci√≥n de Origin</h5>
            <code>
              if ($_SERVER['HTTP_ORIGIN'] !== 'https://mibanco.com') {<br>
              &nbsp;&nbsp;http_response_code(403);<br>
              &nbsp;&nbsp;die('Origen no autorizado');<br>
              }
            </code>
          </div>
        </div>
        
        <div class="mitigation-card">
          <h4>üõ°Ô∏è Cabeceras de Seguridad</h4>
          <p>Implementar cabeceras HTTP adicionales para mejorar la seguridad.</p>
          
          <div class="headers-example">
            <h5>Cabeceras recomendadas</h5>
            <code>
              Content-Security-Policy: default-src 'self'<br>
              X-Frame-Options: DENY<br>
              X-Content-Type-Options: nosniff<br>
              Referrer-Policy: strict-origin-when-cross-origin
            </code>
          </div>
        </div>
        
        <div class="mitigation-card">
          <h4>üîí Doble Confirmaci√≥n</h4>
          <p>Para acciones cr√≠ticas, requerir confirmaci√≥n adicional como re-autenticaci√≥n o 2FA.</p>
          
          <div class="headers-example">
            <h5>Ejemplo de implementaci√≥n</h5>
            <code>
              // Para transferencias &gt; $1000, requerir contrase√±a<br>
              if ($amount &gt; 1000 && !verify_password($_POST['password'])) {<br>
              &nbsp;&nbsp;die('Confirmaci√≥n de contrase√±a requerida');<br>
              }
            </code>
          </div>
        </div>
        
        <div class="mitigation-card">
          <h4>üåê Configuraci√≥n CORS</h4>
          <p>Configurar CORS de manera restrictiva para limitar solicitudes cross-origin.</p>
          
          <div class="headers-example">
            <h5>Configuraci√≥n segura</h5>
            <code>
              Access-Control-Allow-Origin: https://mibanco.com<br>
              Access-Control-Allow-Credentials: true<br>
              Access-Control-Allow-Methods: POST, GET<br>
              Access-Control-Allow-Headers: Content-Type, Authorization
            </code>
          </div>
        </div>
      </div>
      
      <!-- Herramientas -->
      <div class="theory-section" id="tools">
        <h3>üõ†Ô∏è Herramientas de Prueba y An√°lisis</h3>
        
        <div class="tool-card">
          <h4>üîç Burp Suite</h4>
          <p>Herramienta profesional para pruebas de seguridad web con extensiones espec√≠ficas para CSRF.</p>
          <div class="code-example">
            <strong>Caracter√≠sticas clave:</strong>
            <ul>
              <li>Generaci√≥n autom√°tica de PoCs CSRF</li>
              <li>Detecci√≥n de tokens anti-CSRF</li>
              <li>An√°lisis de configuraci√≥n SameSite</li>
            </ul>
          </div>
        </div>
        
        <div class="tool-card">
          <h4>üåê OWASP ZAP</h4>
          <p>Herramienta gratuita de seguridad web con capacidades de detecci√≥n CSRF.</p>
          <div class="code-example">
            <strong>Funcionalidades:</strong>
            <ul>
              <li>Escaneo pasivo de vulnerabilidades CSRF</li>
              <li>Generaci√≥n de reportes detallados</li>
              <li>Integraci√≥n con pipelines CI/CD</li>
            </ul>
          </div>
        </div>
        
        <div class="tool-card">
          <h4>üîß CSRFTester</h4>
          <p>Herramienta espec√≠fica para pruebas de CSRF desarrollada por OWASP.</p>
          <div class="code-example">
            <strong>Uso:</strong>
            <code>
              java -jar CSRFTester.jar<br>
              # 1. Configurar proxy<br>
              # 2. Navegar por la aplicaci√≥n<br>
              # 3. Generar formularios de prueba
            </code>
          </div>
        </div>
        
        <div class="tool-card">
          <h4>üêç Python Scripts</h4>
          <p>Scripts personalizados para automatizar pruebas CSRF.</p>
          <div class="code-example">
            <strong>Ejemplo b√°sico:</strong>
            <code>
              import requests<br>
              <br>
              # Probar CSRF en endpoint<br>
              response = requests.post(<br>
              &nbsp;&nbsp;'https://target.com/transfer',<br>
              &nbsp;&nbsp;data={'to': 'attacker', 'amount': 1000},<br>
              &nbsp;&nbsp;cookies={'session': 'victim_session'}<br>
              )<br>
              <br>
              print(f"Status: {response.status_code}")
            </code>
          </div>
        </div>
      </div>
      
      <!-- Ejemplos -->
      <div class="theory-section" id="examples">
        <h3>üìù Ejemplos Pr√°cticos</h3>
        
        <div class="vulnerability-card">
          <h4>üí∞ Transferencia Bancaria</h4>
          <p>Ejemplo cl√°sico de CSRF para transferencias financieras.</p>
          
          <div class="code-example">
            <strong>Solicitud leg√≠tima:</strong>
            <code>
              POST /transfer HTTP/1.1<br>
              Host: banco.com<br>
              Content-Type: application/x-www-form-urlencoded<br>
              Cookie: session=abc123<br>
              <br>
              to=1234567890&amount=100&currency=EUR
            </code>
          </div>
          
          <div class="code-example">
            <strong>Payload malicioso:</strong>
            <code>
              &lt;form action="https://banco.com/transfer" method="POST"&gt;<br>
              &nbsp;&nbsp;&lt;input name="to" value="atacante123"&gt;<br>
              &nbsp;&nbsp;&lt;input name="amount" value="5000"&gt;<br>
              &nbsp;&nbsp;&lt;input name="currency" value="EUR"&gt;<br>
              &nbsp;&nbsp;&lt;input type="submit" value="¬°Gana $1000!"&gt;<br>
              &lt;/form&gt;
            </code>
          </div>
        </div>
        
        <div class="vulnerability-card">
          <h4>üîê Cambio de Contrase√±a</h4>
          <p>Ataque para cambiar credenciales de usuario.</p>
          
          <div class="code-example">
            <strong>Payload encubierto:</strong>
            <code>
              &lt;img src="https://target.com/change-password?new=hacked123"<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style="display:none;"&gt;<br>
              <br>
              &lt;!-- La imagen "cargar√°" ejecutando el cambio --&gt;
            </code>
          </div>
        </div>
        
        <div class="vulnerability-card">
          <h4>üõí Compra Fraudulenta</h4>
          <p>Realizar compras no autorizadas en e-commerce.</p>
          
          <div class="code-example">
            <strong>JavaScript malicioso:</strong>
            <code>
              fetch('https://tienda.com/buy', {<br>
              &nbsp;&nbsp;method: 'POST',<br>
              &nbsp;&nbsp;credentials: 'include',<br>
              &nbsp;&nbsp;headers: {<br>
              &nbsp;&nbsp;&nbsp;&nbsp;'Content-Type': 'application/json'<br>
              &nbsp;&nbsp;},<br>
              &nbsp;&nbsp;body: JSON.stringify({<br>
              &nbsp;&nbsp;&nbsp;&nbsp;product: 'expensive_item',<br>
              &nbsp;&nbsp;&nbsp;&nbsp;quantity: 10<br>
              &nbsp;&nbsp;})<br>
              });
            </code>
          </div>
        </div>
        
        <div class="mitigation-card">
          <h4>‚úÖ Implementaci√≥n Segura</h4>
          <p>Ejemplo de formulario protegido contra CSRF.</p>
          
          <div class="code-example">
            <strong>Formulario seguro:</strong>
            <code>
              &lt;form action="/transfer" method="POST"&gt;<br>
              &nbsp;&nbsp;&lt;!-- Token Anti-CSRF --&gt;<br>
              &nbsp;&nbsp;&lt;input type="hidden" name="csrf_token" <br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value="&lt;?= $_SESSION['csrf_token'] ?&gt;"&gt;<br>
              &nbsp;&nbsp;<br>
              &nbsp;&nbsp;&lt;input name="to" required&gt;<br>
              &nbsp;&nbsp;&lt;input name="amount" type="number" required&gt;<br>
              &nbsp;&nbsp;&lt;button type="submit"&gt;Transferir&lt;/button&gt;<br>
              &lt;/form&gt;
            </code>
          </div>
          
          <div class="code-example">
            <strong>Validaci√≥n en servidor:</strong>
            <code>
              // Verificar token CSRF<br>
              if (!hash_equals($_SESSION['csrf_token'], $_POST['csrf_token'])) {<br>
              &nbsp;&nbsp;die('Token CSRF inv√°lido');<br>
              }<br>
              <br>
              // Verificar origen<br>
              if ($_SERVER['HTTP_ORIGIN'] !== 'https://mibanco.com') {<br>
              &nbsp;&nbsp;die('Origen no autorizado');<br>
              }<br>
              <br>
              // Procesar transferencia segura<br>
              process_transfer($_POST['to'], $_POST['amount']);
            </code>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal explicaci√≥n -->
<div class="modal fade" id="explainModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-lightbulb me-2"></i>¬øQu√© sucedi√≥?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h6 class="mb-3">Paso a paso del ataque CSRF</h6>
        <ol>
          <li>El usuario inicia sesi√≥n y posee una <em>cookie</em> de sesi√≥n v√°lida.</li>
          <li>Realiza una transferencia leg√≠tima ‚û°Ô∏è la solicitud completa aparece en el panel del atacante.</li>
          <li>El atacante genera un formulario oculto con esos mismos par√°metros.</li>
          <li>Enga√±a al usuario con un enlace en el chat.</li>
          <li>El navegador del usuario env√≠a la <span class="text-danger">solicitud forjada</span> autom√°ticamente porque la cookie se env√≠a junto con el dominio bancario.</li>
          <li>El servidor no distingue entre una acci√≥n intencional y la forjada, por lo que procesa la transferencia.</li>
        </ol>
        
        <h6 class="mt-4 mb-3">Diagrama del ataque</h6>
        <div class="text-center">
          <img src="csrf.png" alt="Diagrama CSRF" class="img-fluid rounded" style="max-width: 100%; height: auto;"/>
        </div>
        
        <h6 class="mt-4 mb-3">Mitigaciones imprescindibles</h6>
        <ul>
          <li><strong>Tokens CSRF √∫nicos y verificables en cada formulario:</strong></li>
          <pre>&lt;input type="hidden" name="csrf_token" value="abc123def456"&gt;</pre>
          
          <li><strong>Cookies con atributo SameSite:</strong></li>
          <pre>Set-Cookie: session_id=abc123; SameSite=Strict; Secure; HttpOnly</pre>
          
          <li><strong>Verificar cabeceras Origin/Referer en el servidor:</strong></li>
          <pre>// Ejemplo en el servidor
if (request.headers.origin !== 'https://securebank.com') {
  return error('Origen no autorizado');
}</pre>
          
          <li><strong>Cabeceras de seguridad adicionales:</strong></li>
          <pre>Content-Security-Policy: default-src 'self'
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
Referrer-Policy: strict-origin-when-cross-origin</pre>
          
          <li><strong>Validaci√≥n de doble factor para operaciones cr√≠ticas</strong></li>
          <li><strong>Configuraci√≥n de CORS restrictiva:</strong></li>
          <pre>Access-Control-Allow-Origin: https://securebank.com
Access-Control-Allow-Credentials: true</pre>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Entendido</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ------- Navegaci√≥n entre p√°ginas -------
document.addEventListener('DOMContentLoaded', function() {
  // Funci√≥n para sincronizar altura del chat con la columna central
  function syncChatHeight() {
    const attackerCard = document.querySelector('.attacker-card');
    const chatContainer = document.querySelector('.chat-container');
    
    if (attackerCard && chatContainer) {
      // Obtener la altura actual de la columna central (atacante)
      const attackerHeight = attackerCard.offsetHeight;
      const chatCard = chatContainer.closest('.chat-card');
      
      if (chatCard) {
        // Calcular el padding y margins de la tarjeta del chat
        const chatCardStyles = window.getComputedStyle(chatCard);
        const chatCardPadding = parseInt(chatCardStyles.paddingTop) + parseInt(chatCardStyles.paddingBottom);
        const chatCardMargin = parseInt(chatCardStyles.marginTop) + parseInt(chatCardStyles.marginBottom);
        
        // Calcular el padding del contenedor del chat
        const chatContainerStyles = window.getComputedStyle(chatContainer);
        const chatContainerPadding = parseInt(chatContainerStyles.paddingTop) + parseInt(chatContainerStyles.paddingBottom);
        
        // Calcular la altura m√°xima disponible para el chat
        const availableHeight = attackerHeight - chatCardPadding - chatContainerPadding -  60; // 60px para el header
        
        // Establecer la altura m√°xima del chat
        chatContainer.style.maxHeight = `${availableHeight}px`;
      }
    }
  }
  
  // Ejecutar la sincronizaci√≥n inicialmente
  syncChatHeight();
  
  // Ejecutar la sincronizaci√≥n cuando cambie el tama√±o de la ventana
  window.addEventListener('resize', syncChatHeight);
  
  // Ejecutar la sincronizaci√≥n cuando se a√±adan nuevos elementos al DOM
  const observer = new MutationObserver(function() {
    setTimeout(syncChatHeight, 100); // Peque√±o delay para que el DOM se actualice
  });
  
  // Observar cambios en el contenido de las tarjetas
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });

  // Manejar navegaci√≥n entre p√°ginas
  document.querySelectorAll('.nav-button').forEach(button => {
    button.addEventListener('click', function() {
      const targetPage = this.getAttribute('data-page');
      
      // Manejar bot√≥n especial de modo desaf√≠o
      if (this.id === 'challengeNavBtn') {
        // Cambiar a la p√°gina del simulador si no est√° ya activa
        if (!document.getElementById('simulator-page').classList.contains('active')) {
          switchPage('simulator');
        }
        
        // Activar directamente el modo desaf√≠o
        startChallenge();
        
        // Actualizar botones activos - modo desaf√≠o
        document.querySelectorAll('.nav-button').forEach(btn => {
          btn.classList.remove('active', 'challenge-active');
        });
        document.getElementById('challengeNavBtn').classList.add('challenge-active');
        return;
      }
      
      if (targetPage) {
        // Si se est√° en modo desaf√≠o y se hace clic en "Simulador", resetear el modo desaf√≠o
        if (challengeMode && targetPage === 'simulator') {
          resetChallenge();
        }
        
        switchPage(targetPage);
        
        // Actualizar botones activos - modo normal
        document.querySelectorAll('.nav-button').forEach(btn => {
          btn.classList.remove('active', 'challenge-active');
        });
        this.classList.add('active');
      }
    });
  });
  
  // Manejar navegaci√≥n del centro de aprendizaje
  document.querySelectorAll('.learning-nav-button').forEach(button => {
    button.addEventListener('click', function() {
      const targetSection = this.getAttribute('data-section');
      switchLearningSection(targetSection);
      
      // Actualizar botones activos
      document.querySelectorAll('.learning-nav-button').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
    });
  });
});

function switchPage(pageId) {
  // Ocultar todas las p√°ginas
  document.querySelectorAll('.page').forEach(page => {
    page.classList.remove('active');
  });
  
  // Mostrar la p√°gina seleccionada
  const targetPage = document.getElementById(pageId + '-page');
  if (targetPage) {
    targetPage.classList.add('active');
  }
}

function switchLearningSection(sectionId) {
  // Ocultar todas las secciones
  document.querySelectorAll('.theory-section').forEach(section => {
    section.classList.remove('active');
  });
  
  // Mostrar la secci√≥n seleccionada
  const targetSection = document.getElementById(sectionId);
  if (targetSection) {
    targetSection.classList.add('active');
  }
}

// ------- C√≥digo del simulador existente -------
let balance = 5000;
const balanceText = document.getElementById('balanceText');
const historyBody = document.querySelector('#history tbody');
const captureBox = document.getElementById('captureBox');
const pocBox = document.getElementById('pocBox');
const msgs = document.getElementById('msgs');
const transferMsg = document.getElementById('transferMsg');
const explainBtn = document.getElementById('explainBtn');
const transferBtn = document.getElementById('transferBtn');
const sendAttack = document.getElementById('sendAttack');
const sendPhishing = document.getElementById('sendPhishing');
const challengeBtn = document.getElementById('challengeBtn');
const challengeContent = document.getElementById('challengeContent');
const challengeTargetBox = document.getElementById('challengeTargetBox');
const challengePayload = document.getElementById('challengePayload');
const submitChallenge = document.getElementById('submitChallenge');
const challengeResult = document.getElementById('challengeResult');
let captured = null;
let challengeMode = false;
let challengeTarget = null;

function dollar(n) {
  return `$${n.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
}

function formatMessage(text) {
  // Convertir **texto** a <strong>texto</strong>
  // Usar expresi√≥n regular global para capturar todos los casos
  return text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
}

function addBubble(text, right = false) {
  const div = document.createElement('div');
  div.className = `bubble ${right ? 'right-bub' : 'left-bub'}`;
  
  const messageTime = new Date().toLocaleTimeString('es-ES', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
  
  const sender = right ? 'üë§ V√≠ctima' : 'üïµÔ∏è Atacante';
  
  div.innerHTML = `
    <div><strong>${sender}:</strong> ${formatMessage(text)}</div>
    <div class="chat-time">${messageTime}</div>
  `;
  
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function addSystemBubble(text) {
  const div = document.createElement('div');
  div.className = 'bubble system-bub';
  
  const messageTime = new Date().toLocaleTimeString('es-ES', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
  
  div.innerHTML = `
    <div><strong>üè¶ Sistema:</strong> ${formatMessage(text)}</div>
    <div class="chat-time">${messageTime}</div>
  `;
  
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function addAppBubble(text) {
  const div = document.createElement('div');
  div.className = 'bubble app-bub';
  
  const messageTime = new Date().toLocaleTimeString('es-ES', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
  
  div.innerHTML = `
    <div><strong>üéì Instructor:</strong> ${formatMessage(text)}</div>
    <div class="chat-time">${messageTime}</div>
  `;
  
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function addBankBubble(text) {
  const div = document.createElement('div');
  div.className = 'bubble left-bub';
  
  const messageTime = new Date().toLocaleTimeString('es-ES', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
  
  div.innerHTML = `
    <div><strong>üè¶ Banco:</strong> ${formatMessage(text)}</div>
    <div class="chat-time">${messageTime}</div>
  `;
  
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

// Funci√≥n expandChat eliminada - ya no es necesaria



function logTransfer(to, amount, csrf = false) {
  const tr = document.createElement('tr');
  const shortTo = to.length > 12 ? to.substring(0, 12) + '...' : to;
  tr.innerHTML = `
    <td>${new Date().toLocaleDateString()}</td>
    <td title="${to}">${shortTo}</td>
    <td>${dollar(amount)}</td>
    <td>${csrf ? '<span class="badge bg-danger status-badge">CSRF</span>' : '<span class="badge bg-success status-badge">OK</span>'}</td>
  `;
  historyBody.prepend(tr);
}

function showTransferMessage(prevBalance, newBalance) {
  transferMsg.style.display = 'block';
  transferMsg.textContent = `Saldo anterior: ${dollar(prevBalance)} | Saldo actual: ${dollar(newBalance)}`;
  setTimeout(() => {
    transferMsg.style.display = 'none';
  }, 6000);
}

// ------- Transferencia leg√≠tima -------
transferBtn.addEventListener('click', () => {
  const to = document.getElementById('to').value.trim();
  const amt = parseFloat(document.getElementById('amount').value);
  
  if (!to || !amt || amt <= 0) {
    alert('Por favor, completa todos los campos correctamente');
    return;
  }
  
  if (amt > balance) {
    alert('Saldo insuficiente');
    return;
  }
  
  const prevBalance = balance;
  balance -= amt;
  balanceText.textContent = dollar(balance);
  showTransferMessage(prevBalance, balance);
  logTransfer(to, amt);
  
  // Construir solicitud estilo BurpSuite con JWT y cookies realistas
  const jwtToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';
  const sessionId = 'sess_' + Math.random().toString(36).substring(2, 15);
  const csrfToken = 'csrf_' + Math.random().toString(36).substring(2, 10);
  
  captured = `POST /api/v1/transfer HTTP/1.1
Host: securebank.com
Content-Type: application/json
Authorization: Bearer ${jwtToken}
Cookie: session_id=${sessionId}; auth_token=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMTIzIn0.ktnlVHtruc2; __Secure-csrf=${csrfToken}
X-Requested-With: XMLHttpRequest
Origin: https://securebank.com
Referer: https://securebank.com/dashboard

{
  "recipient": "${to}",
  "amount": ${amt},
  "currency": "USD",
  "csrf_token": "${csrfToken}"
}`;
  
  captureBox.textContent = captured;
  
  // Resetear el estado del atacante
  sendAttack.innerHTML = '<i class="bi bi-exclamation-triangle me-2"></i>Generar payload malicioso';
  sendAttack.disabled = false;
  sendPhishing.style.display = 'none';
  sendPhishing.innerHTML = '<i class="bi bi-send me-2"></i>Enviar mensaje a la v√≠ctima';
  sendPhishing.disabled = false;
  
  // NO generar PoC autom√°ticamente, solo cuando el atacante presione el bot√≥n
  pocBox.textContent = '// Presiona "Generar payload malicioso" para crear el exploit';
  
  addBankBubble('‚úÖ Transferencia realizada exitosamente. El dinero ha sido enviado a la cuenta especificada.');
  addBubble('üòä ¬°Perfecto! Mi cuenta sigue segura con SecureBank.', true);
});

// ------- Bot√≥n de cambio de contrase√±a en modo desaf√≠o -------
const changePasswordBtn = document.getElementById('changePasswordBtn');
changePasswordBtn.addEventListener('click', () => {
  if (!challengeMode) return;
  
  const currentPassword = document.getElementById('currentPassword').value;
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  
  if (!currentPassword || !newPassword || !confirmPassword) {
    addBubble('‚ùå Por favor completa todos los campos de contrase√±a.', true);
    return;
  }
  
  if (newPassword !== confirmPassword) {
    addBubble('‚ùå Las contrase√±as no coinciden.', true);
    return;
  }
  
  // Capturar la solicitud solo en modo desaf√≠o
  capturePasswordChangeRequest(currentPassword, newPassword);
  
  // Simular cambio exitoso
  addBankBubble('‚úÖ Contrase√±a cambiada exitosamente. Tu cuenta est√° ahora m√°s segura.');
  addBubble('üîê Perfecto, he actualizado mi contrase√±a. Ahora mi cuenta est√° protegida.', true);
  
  // Limpiar campos
  document.getElementById('currentPassword').value = '';
  document.getElementById('newPassword').value = '';
  document.getElementById('confirmPassword').value = '';
});

function capturePasswordChangeRequest(currentPassword, newPassword) {
  const jwtToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';
  const sessionId = 'sess_' + Math.random().toString(36).substring(2, 15);
  const victimEmail = 'john.doe@securebank.com';
  
  const challengeCapture = `POST /change-password HTTP/1.1
Host: securebank.com
Content-Type: application/x-www-form-urlencoded
Cookie: session=${sessionId}; auth=valid
Origin: https://securebank.com
Referer: https://securebank.com/profile
X-User-Email: ${victimEmail}

current_password=${currentPassword}&new_password=${newPassword}&confirm_password=${newPassword}&user_email=${victimEmail}`;
  
  // Mostrar la captura en el chat del sistema
  addSystemBubble('üì° **Solicitud capturada del usuario:** El usuario ha cambiado su contrase√±a. El atacante ahora puede ver la estructura de la solicitud HTTP y el email de la v√≠ctima.');
  
  // Mensajes del atacante simulando el an√°lisis
  setTimeout(() => {
    addBubble('üïµÔ∏è ¬°Perfecto! He interceptado la solicitud de cambio de contrase√±a.', false);
  }, 1000);
  
  setTimeout(() => {
    addBubble(`üìß Excelente, tambi√©n captur√© el email de la v√≠ctima: ${victimEmail}`, false);
  }, 2500);
  
  setTimeout(() => {
    addBubble('üîç D√©jame analizar la estructura: m√©todo POST, URL /change-password, y los par√°metros necesarios...', false);
  }, 4000);
  
  setTimeout(() => {
    addBubble('üí° Ya tengo toda la informaci√≥n que necesito. Ahora puedo crear un formulario malicioso que replique esta acci√≥n.', false);
  }, 5500);
  
  setTimeout(() => {
    addSystemBubble('üí° **Pista:** Analiza la solicitud HTTP capturada. ¬øQu√© campos son necesarios? ¬øCu√°l es el m√©todo y la URL? Usa esta informaci√≥n para crear tu payload CSRF.');
  }, 7000);
  
  // Actualizar el objetivo del desaf√≠o con la solicitud real capturada
  challengeTarget.request = challengeCapture;
  challengeTarget.expectedFields = ['current_password', 'new_password', 'confirm_password', 'user_email'];
  challengeTargetBox.textContent = challengeCapture;
}

// ------- Ataque CSRF -------
function csrfAttack(e) {
  e.preventDefault();
  const prevBalance = balance;
  const stealAmount = parseFloat(document.getElementById('stealAmount').value) || 1500;
  
  if (stealAmount > balance) {
    addBubble('üòà El usuario no tiene suficiente saldo para robar esa cantidad...');
    return;
  }
  
  balance -= stealAmount;
  balanceText.textContent = dollar(balance);
  logTransfer('4001-1234-5678-9999', stealAmount, true);
  
  addBubble(`üòà ¬°Transferencia CSRF ejecutada exitosamente! Rob√© ${dollar(stealAmount)}! Revisa tu saldo...`);
  addBubble('üò± ¬°¬øQu√©?! ¬°Mi dinero! ¬øC√≥mo es posible?', true);      showTransferMessage(prevBalance, balance);
      explainBtn.style.display = 'block';
      challengeBtn.style.display = 'block';
}

sendAttack.addEventListener('click', () => {
  if (!captured) {
    alert('Primero debes capturar una solicitud. El usuario debe realizar una transferencia.');
    return;
  }
  
  const stealAmount = parseFloat(document.getElementById('stealAmount').value) || 1500;
  
  // Generar la PoC con la cantidad personalizada
  pocBox.textContent = `<!-- Formulario malicioso generado -->
<form action='https://securebank.com/api/v1/transfer' method='POST' style='display:none;'>
  <input name='recipient' value='4001-1234-5678-9999'>
  <input name='amount' value='${stealAmount}'>
  <input name='currency' value='USD'>
  <input type='submit' value='Enviar'>
</form>
<script>document.forms[0].submit();<\/script>`;
  
  // Mostrar el bot√≥n para enviar el mensaje de phishing
  sendPhishing.style.display = 'block';
  
  // Cambiar el texto del bot√≥n original
  sendAttack.innerHTML = '<i class="bi bi-check-circle me-2"></i>Payload generado';
  sendAttack.disabled = true;
  
  // Agregar mensaje informativo del atacante
  addBubble('üîß Excelente. He generado un formulario malicioso que replicar√° la transferencia. Ahora necesito enga√±ar a la v√≠ctima...');
});

// ------- Enviar mensaje de phishing -------
sendPhishing.addEventListener('click', () => {
  // Enviar mensaje de phishing realista al chat
  addBubble('üîí Hola, soy del departamento de seguridad de SecureBank. Hemos detectado actividad sospechosa en tu cuenta en los √∫ltimos minutos.');
  setTimeout(() => {
    addBubble('‚ö†Ô∏è Por tu seguridad, necesitamos que verifiques tu identidad inmediatamente. Haz clic en el siguiente enlace para acceder al sistema de verificaci√≥n:');
    setTimeout(() => {
      addBubble('üîó <a href="#" onclick="executeCSRFAttack(); return false;" style="color: #3b82f6; text-decoration: underline; font-weight: 600;">https://securebank.com/security-verification</a>');
      setTimeout(() => {
        addBubble('‚è∞ Este enlace expirar√° en 5 minutos. Es urgente que completes la verificaci√≥n para proteger tu cuenta.');
      }, 1000);
    }, 1500);
  }, 2000);
  
  // Deshabilitar el bot√≥n despu√©s de enviar
  sendPhishing.innerHTML = '<i class="bi bi-check-circle me-2"></i>Mensaje enviado';
  sendPhishing.disabled = true;
});

// ------- Ejecutar ataque CSRF cuando se hace clic en el enlace -------
function executeCSRFAttack() {
  addBubble('ü§î Hmm, d√©jame verificar mi identidad. Parece urgente...', true);
  addBubble('ÔøΩ *haciendo clic en el enlace*', true);
  
  setTimeout(() => {
    addBubble('ÔøΩüíÄ El usuario ha hecho clic en el enlace malicioso...');
  }, 1000);
  
  // Ejecutar el ataque CSRF
  setTimeout(() => {
    const stealAmount = parseFloat(document.getElementById('stealAmount').value) || 1500;
    
    if (balance >= stealAmount) {
      const prevBalance = balance;
      balance -= stealAmount;
      balanceText.textContent = dollar(balance);
      logTransfer('4001-1234-5678-9999', stealAmount, true);
      
      addBubble(`üí∞ ¬°Ataque exitoso! Se han robado ${dollar(stealAmount)} de la cuenta de la v√≠ctima.`);
      transferMsg.innerHTML = `<i class="bi bi-exclamation-triangle me-2"></i>¬°Ataque CSRF completado! Se transfirieron ${dollar(stealAmount)} sin autorizaci√≥n.`;
      transferMsg.style.display = 'block';
      transferMsg.style.background = '#dc2626';
      transferMsg.style.color = 'white';
      transferMsg.style.border = '1px solid #dc2626';
      
      // Mostrar el bot√≥n de explicaci√≥n despu√©s del ataque exitoso
      explainBtn.style.display = 'block';
      challengeBtn.style.display = 'block';
      
      // A√±adir respuesta del cliente despu√©s del ataque
      setTimeout(() => {
        addBubble('üò® ¬°Espera! ¬øQu√© acaba de pasar? ¬°Mi saldo ha disminuido!', true);
        setTimeout(() => {
          addBubble('üò† ¬°No hice ninguna transferencia a esa cuenta! ¬øC√≥mo es posible?', true);
          setTimeout(() => {
            addBubble('üö® ¬°Esto es un fraude! ¬øC√≥mo pudieron robar mi dinero solo con hacer clic en un enlace?', true);
            setTimeout(() => {
              addBankBubble('üè¶ Estimado cliente, nuestro sistema de seguridad ha detectado que acaba de ser v√≠ctima de un ataque CSRF (Cross-Site Request Forgery). Le explicamos lo que ocurri√≥:');
              setTimeout(() => {
                addBankBubble('üîç **¬øC√≥mo funcion√≥ el ataque?** 1) Usted realiz√≥ una transferencia leg√≠tima ‚Üí 2) Un atacante captur√≥ la estructura de su solicitud ‚Üí 3) El atacante cre√≥ un formulario malicioso que replica esa solicitud');
                setTimeout(() => {
                  addBankBubble('‚ö†Ô∏è **El problema:** Su navegador envi√≥ autom√°ticamente las cookies de sesi√≥n con el formulario malicioso, haciendo que nuestro servidor procesara la transferencia como si fuera autorizada por usted.');
                  setTimeout(() => {
                    addBankBubble('üõ°Ô∏è **Medidas de protecci√≥n:** Implementamos tokens CSRF, cookies SameSite=Strict y verificaci√≥n de origen para prevenir estos ataques. Para m√°s detalles t√©cnicos, <a href="#" onclick="document.getElementById(\'explainBtn\').click(); return false;" style="color: #2563eb; text-decoration: underline; font-weight: 600;">consulte aqu√≠ la explicaci√≥n completa</a>');
                  }, 2000);
                }, 2500);
              }, 2000);
            }, 2000);
          }, 2000);
        }, 1500);
      }, 3000);
      
      showTransferMessage(prevBalance, balance);
      
    } else {
      addBubble(`‚ùå Error: Saldo insuficiente. Solo quedan ${dollar(balance)} en la cuenta.`);
      addBubble('üòÆ‚Äçüí® ¬°Por suerte no ten√≠a suficiente dinero! Pero... ¬øqu√© hubiera pasado si tuviera m√°s saldo?', true);
      transferMsg.innerHTML = `<i class="bi bi-x-circle me-2"></i>Error: Saldo insuficiente para robar ${dollar(stealAmount)}`;
      transferMsg.style.display = 'block';
      transferMsg.style.background = '#dc2626';
      transferMsg.style.color = 'white';
      transferMsg.style.border = '1px solid #dc2626';
      
      // Mostrar explicaci√≥n incluso si no hay saldo suficiente
      explainBtn.style.display = 'block';
      challengeBtn.style.display = 'block';
      
      // Explicar el ataque incluso si fall√≥
      setTimeout(() => {
        addBankBubble('üè¶ Estimado cliente, aunque la transferencia no se complet√≥ por saldo insuficiente, nuestro sistema detect√≥ un intento de ataque CSRF. Le explicamos qu√© ocurri√≥:');
        setTimeout(() => {
          addBankBubble('‚ö†Ô∏è **¬øQu√© pas√≥?** Su navegador envi√≥ una solicitud de transferencia sin su conocimiento cuando hizo clic en el enlace. Si hubiera tenido m√°s saldo, la transferencia se habr√≠a ejecutado.');
          setTimeout(() => {
            addBankBubble('üõ°Ô∏è **Lecci√≥n importante:** Nunca haga clic en enlaces sospechosos, incluso si parecen ser de su banco. Para conocer m√°s sobre c√≥mo protegerse, <a href="#" onclick="document.getElementById(\'explainBtn\').click(); return false;" style="color: #2563eb; text-decoration: underline; font-weight: 600;">consulte aqu√≠ la explicaci√≥n completa</a>');
          }, 2500);
        }, 2000);
      }, 2000);
    }
  }, 2000);
}

// ------- Modo Desaf√≠o -------
challengeBtn.addEventListener('click', () => {
  startChallenge();
});

submitChallenge.addEventListener('click', () => {
  validateChallenge();
});

function startChallenge() {
  challengeMode = true;
  
  // Limpiar el chat completamente
  const chatContainer = document.querySelector('.chat-container');
  chatContainer.innerHTML = '';
  
  // Cambiar la vista del usuario al modo desaf√≠o
  document.getElementById('userNormalContent').style.display = 'none';
  document.getElementById('userChallengeContent').style.display = 'block';
  
  // Ocultar elementos espec√≠ficos del atacante que no deben aparecer en modo desaf√≠o
  const attackerElementsToHide = [
    'captureBox',
    'sendAttack',
    'sendPhishing',
    'pocBox',
    'explainBtn',
    'stealAmount'
  ];
  
  attackerElementsToHide.forEach(elementId => {
    const element = document.getElementById(elementId);
    if (element) {
      element.style.display = 'none';
    }
  });
  
  // Ocultar tambi√©n las cajas de informaci√≥n del atacante
  const attackerInfoBoxes = document.querySelectorAll('.attacker-card .info-box');
  attackerInfoBoxes.forEach(box => {
    box.style.display = 'none';
  });
  
  // Ocultar headings del atacante normal
  const attackerHeadings = document.querySelectorAll('.attacker-card h6');
  attackerHeadings.forEach(heading => {
    if (!heading.closest('#challengeContent')) {
      heading.style.display = 'none';
    }
  });
  
  // Ocultar historial del usuario
  const historialSection = document.getElementById('historialSection');
  if (historialSection) {
    historialSection.style.display = 'none';
  }
  
  // Configurar el objetivo del desaf√≠o para cambio de contrase√±a
  challengeTarget = {
    name: 'Cambio de Contrase√±a',
    request: `POST /change-password HTTP/1.1
Host: securebank.com
Content-Type: application/x-www-form-urlencoded
Cookie: session=user123; auth=valid
Origin: https://securebank.com
Referer: https://securebank.com/profile
X-User-Email: john.doe@securebank.com

current_password=userpass&new_password=newpass&confirm_password=newpass&user_email=john.doe@securebank.com`,
    expectedFields: ['current_password', 'new_password', 'confirm_password', 'user_email'],
    action: '/change-password',
    method: 'POST'
  };
  
  challengeTargetBox.textContent = 'Esperando que el usuario interact√∫e con el formulario...';
  
  // Mostrar contenido del desaf√≠o
  challengeContent.style.display = 'block';
  challengeBtn.style.display = 'none';
  
  // A√±adir efecto visual a las tarjetas
  document.querySelector('.attacker-card').classList.add('challenge-mode');
  document.querySelector('.user-card').classList.add('challenge-mode');
  
  // Mensajes iniciales del desaf√≠o
  addSystemBubble('üéØ **¬°DESAF√çO ACTIVADO!** Ahora eres el atacante. Tu objetivo es crear un payload CSRF que explote la funcionalidad del usuario.');
  addSystemBubble('üìã **Instrucciones:** El usuario est√° navegando en su perfil. Cuando haga clic en "Cambiar Contrase√±a", capturar√°s la solicitud HTTP. Usa esa informaci√≥n para crear tu ataque.');
  addBubble('üéì Es mi turno de ser el atacante. Voy a crear un payload CSRF malicioso...', false);
  addBubble('üîç Primero necesito que el usuario interact√∫e con el formulario para capturar la solicitud.', false);
}

function generateChallengeTarget() {
  const scenarios = [
    {
      name: 'Cambio de Contrase√±a',
      request: `POST /change-password HTTP/1.1
Host: securebank.com
Content-Type: application/x-www-form-urlencoded
Cookie: session=user123; auth=valid
Origin: https://securebank.com
Referer: https://securebank.com/profile

current_password=oldpass123&new_password=newpass456&confirm_password=newpass456`,
      expectedFields: ['current_password', 'new_password', 'confirm_password'],
      action: '/change-password',
      method: 'POST'
    },
    {
      name: 'Cambio de Email',
      request: `POST /update-email HTTP/1.1
Host: securebank.com
Content-Type: application/x-www-form-urlencoded
Cookie: session=user123; auth=valid
Origin: https://securebank.com
Referer: https://securebank.com/profile

email=newemail@attacker.com&confirm_email=newemail@attacker.com`,
      expectedFields: ['email', 'confirm_email'],
      action: '/update-email',
      method: 'POST'
    },
    {
      name: 'Eliminaci√≥n de Cuenta',
      request: `POST /delete-account HTTP/1.1
Host: securebank.com
Content-Type: application/x-www-form-urlencoded
Cookie: session=user123; auth=valid
Origin: https://securebank.com
Referer: https://securebank.com/settings

confirmation=DELETE&password=userpass123`,
      expectedFields: ['confirmation', 'password'],
      action: '/delete-account',
      method: 'POST'
    }
  ];
  
  return scenarios[Math.floor(Math.random() * scenarios.length)];
}

function validateChallenge() {
  const payload = challengePayload.value.trim();
  const result = challengeResult;
  
  if (!payload) {
    showChallengeResult('error', '‚ùå Debes escribir un payload CSRF v√°lido.');
    addBubble('ü§î Hmm, parece que necesito escribir algo en el campo de payload.', false);
    return;
  }
  
  // Validaciones b√°sicas
  const validations = [
    {
      check: payload.includes('<form'),
      message: 'El payload debe contener un elemento <form>',
      hint: 'Un ataque CSRF necesita un formulario HTML para enviar la solicitud.'
    },
    {
      check: payload.includes(challengeTarget.action) || payload.includes('https://securebank.com' + challengeTarget.action),
      message: `El formulario debe apuntar a ${challengeTarget.action} o https://securebank.com${challengeTarget.action}`,
      hint: 'El atributo "action" debe coincidir con la URL de la solicitud capturada (puede ser ruta relativa o URL completa).'
    },
    {
      check: payload.includes('method="POST"') || payload.includes("method='POST'"),
      message: 'El formulario debe usar method="POST"',
      hint: 'El m√©todo HTTP debe coincidir con la solicitud original.'
    },
    {
      check: challengeTarget.expectedFields.every(field => payload.includes(`name="${field}"`) || payload.includes(`name='${field}'`)),
      message: `El formulario debe incluir todos los campos: ${challengeTarget.expectedFields.join(', ')}`,
      hint: 'Todos los par√°metros de la solicitud original deben estar presentes como campos del formulario.'
    }
  ];
  
  for (let validation of validations) {
    if (!validation.check) {
      showChallengeResult('error', `‚ùå ${validation.message}`);
      addBubble(`üí≠ ${validation.hint}`, false);
      return;
    }
  }
  
  // Si pasa todas las validaciones
  showChallengeResult('success', 'üéâ ¬°Excelente! Has creado un payload CSRF v√°lido. Iniciando simulaci√≥n del ataque...');
  
  // Simular el ataque completo
  simulateCSRFAttack();
}

function simulateCSRFAttack() {
  // Mensajes del atacante sobre el ataque
  addBubble('üéØ ¬°Perfecto! Mi payload CSRF es v√°lido.', false);
  
  setTimeout(() => {
    addBubble('üìß Ahora voy a enviar un enlace malicioso a la v√≠ctima john.doe@securebank.com', false);
  }, 1500);
  
  setTimeout(() => {
    addBubble('üì± Enviando mensaje: "¬°Felicidades! Has ganado un premio. Haz clic aqu√≠: <a href="#" onclick="executeChallengeAttack(); return false;" style="color: #3b82f6; text-decoration: underline; font-weight: 600;">http://attacker.com/prize</a>"', false);
  }, 3000);
  
  setTimeout(() => {
    addSystemBubble('üì® **Mensaje enviado a la v√≠ctima:** El atacante ha enviado un enlace malicioso que contiene el payload CSRF.');
  }, 4500);
  
  // Mensajes de la v√≠ctima
  setTimeout(() => {
    addBubble('üìß ¬°Wow! ¬°He recibido un mensaje sobre un premio!', true);
  }, 6000);
  
  setTimeout(() => {
    addBubble('ü§î D√©jame hacer clic en el enlace para ver qu√© premio gan√©... <a href="#" onclick="executeChallengeAttack(); return false;" style="color: #3b82f6; text-decoration: underline; font-weight: 600;">http://attacker.com/prize</a>', true);
  }, 7500);
  
  setTimeout(() => {
    addSystemBubble('‚è≥ **Esperando tu interacci√≥n:** Haz clic en el enlace malicioso para ver c√≥mo se ejecuta el ataque CSRF en tiempo real.');
  }, 9000);
  
  setTimeout(() => {
    addSystemBubble('üëÜ **Pista:** El enlace azul es cliqueable. Haz clic en √©l para simular que la v√≠ctima cae en la trampa del atacante.');
  }, 11000);
}

// ------- Ejecutar ataque CSRF en modo desaf√≠o -------
function executeChallengeAttack() {
  // Confirmar que el usuario real hizo clic
  addSystemBubble('üñ±Ô∏è **¬°USUARIO REAL HIZO CLIC!** Has simulado que la v√≠ctima hace clic en el enlace malicioso.');
  
  addBubble('üñ±Ô∏è *Haciendo clic en el enlace malicioso*', true);
  
  setTimeout(() => {
    addBubble('üåê Cargando p√°gina del premio...', true);
  }, 1000);
  
  setTimeout(() => {
    addSystemBubble('‚ö° **¬°ATAQUE CSRF EJECUTADO!** El navegador de la v√≠ctima ha enviado autom√°ticamente la solicitud de cambio de contrase√±a sin su conocimiento.');
  }, 2500);
  
  setTimeout(() => {
    addBubble('üîÑ *El formulario CSRF se ejecuta en segundo plano*', true);
  }, 4000);
  
  // Cambio de contrase√±a ejecutado
  setTimeout(() => {
    addBankBubble('‚úÖ **Contrase√±a cambiada con √©xito** - Tu nueva contrase√±a ha sido actualizada.');
  }, 5500);
  
  setTimeout(() => {
    addBubble('üòï ¬øEh? ¬øQu√© contrase√±a? Yo solo hice clic en un enlace de un premio...', true);
  }, 7000);
  
  setTimeout(() => {
    addBubble('üò® ¬°Espera! ¬øAlguien cambi√≥ mi contrase√±a sin mi permiso?', true);
  }, 8500);
  
  setTimeout(() => {
    addBubble('üò° ¬°HE SIDO HACKEADO! ¬°Alguien tiene acceso a mi cuenta!', true);
  }, 10000);
  
  setTimeout(() => {
    addBubble('üö® ¬°BANCO SECUREBANK! ¬°Mi cuenta ha sido comprometida! ¬°Necesito ayuda urgente!', true);
  }, 11500);
  
  // Mensaje del atacante triunfante
  setTimeout(() => {
    addBubble('üòà ¬°Misi√≥n cumplida! He logrado cambiar la contrase√±a de la v√≠ctima usando CSRF.', false);
  }, 13000);
  
  setTimeout(() => {
    addBubble('üéØ La v√≠ctima nunca sospech√≥ que mi enlace "inocente" ejecutar√≠a acciones en su cuenta bancaria.', false);
  }, 14500);
  
  setTimeout(() => {
    addSystemBubble('üéì **LECCI√ìN APRENDIDA:** As√≠ es como funciona un ataque CSRF real. Un simple clic en un enlace malicioso puede comprometer completamente una cuenta.');
  }, 16000);
  
  setTimeout(() => {
    addSystemBubble('üîí **PROTECCI√ìN:** Para prevenir esto, las aplicaciones deben usar tokens CSRF, validar el origen de las solicitudes y implementar autenticaci√≥n multifactor.');
  }, 17500);
  
  setTimeout(() => {
    addSystemBubble('‚úÖ **¬°DESAF√çO COMPLETADO!** Has experimentado un ataque CSRF completo. Usa el bot√≥n "Simulador" en la barra superior para regresar al modo normal.');
  }, 19000);
}

function showChallengeResult(type, message) {
  const result = challengeResult;
  result.className = `challenge-result ${type}`;
  result.textContent = message;
  result.style.display = 'block';
  
  // Ocultar el resultado despu√©s de 5 segundos si es un error
  if (type === 'error') {
    setTimeout(() => {
      result.style.display = 'none';
    }, 5000);
  }
}

function resetChallenge() {
  challengeMode = false;
  
  // Restaurar la vista normal del usuario
  document.getElementById('userNormalContent').style.display = 'block';
  document.getElementById('userChallengeContent').style.display = 'none';
  
  // Mostrar elementos del atacante que estaban ocultos en modo desaf√≠o
  const attackerElementsToShow = [
    'captureBox',
    'sendAttack',
    'sendPhishing',
    'pocBox',
    'explainBtn',
    'stealAmount'
  ];
  
  attackerElementsToShow.forEach(elementId => {
    const element = document.getElementById(elementId);
    if (element) {
      element.style.display = element.tagName === 'BUTTON' ? 'block' : 'block';
    }
  });
  
  // Restaurar las cajas de informaci√≥n del atacante
  const attackerInfoBoxes = document.querySelectorAll('.attacker-card .info-box');
  attackerInfoBoxes.forEach(box => {
    box.style.display = 'block';
  });
  
  // Restaurar headings del atacante normal
  const attackerHeadings = document.querySelectorAll('.attacker-card h6');
  attackerHeadings.forEach(heading => {
    if (!heading.closest('#challengeContent')) {
      heading.style.display = 'block';
    }
  });
  
  // Restaurar historial del usuario
  const historialSection = document.getElementById('historialSection');
  if (historialSection) {
    historialSection.style.display = 'block';
  }
  
  // Ocultar contenido del desaf√≠o
  challengeContent.style.display = 'none';
  challengePayload.value = '';
  challengeResult.style.display = 'none';
  
  // Restaurar el bot√≥n de desaf√≠o
  challengeBtn.style.display = 'block';
  
  // Quitar efectos visuales
  document.querySelector('.attacker-card').classList.remove('challenge-mode');
  document.querySelector('.user-card').classList.remove('challenge-mode');
  
  // Restaurar el chat al estado inicial
  const chatContainer = document.querySelector('.chat-container');
  chatContainer.innerHTML = '';
  addBankBubble('¬°Bienvenido a SecureBank! üè¶ Tu cuenta est√° protegida con nuestros mejores sistemas de seguridad.');
  addSystemBubble('Para comenzar la simulaci√≥n, realiza una transferencia leg√≠tima usando el panel izquierdo. El atacante capturar√° autom√°ticamente tu solicitud.');
}

// ------- Funciones existentes -------
explainBtn.addEventListener('click', () => {
  const modal = new bootstrap.Modal(document.getElementById('explainModal'));
  modal.show();
});

// Mensaje inicial
addBankBubble('¬°Bienvenido a SecureBank! üè¶ Tu cuenta est√° protegida con nuestros mejores sistemas de seguridad.');
addSystemBubble('Para comenzar la simulaci√≥n, realiza una transferencia leg√≠tima usando el panel izquierdo. El atacante capturar√° autom√°ticamente tu solicitud.');
</script>
</body>
</html>
